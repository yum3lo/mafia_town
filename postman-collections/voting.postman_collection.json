{
  "info": {
    "name": "Voting Service",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.3",
    "variable": [
      { "key": "base_url", "value": "http://localhost:8000" },
      { "key": "game_id", "value": "game-AAA" },
      { "key": "round_id", "value": "round-9f3a2b" },
      { "key": "user_id", "value": "2" },
      { "key": "jwt", "value": "REPLACE_WITH_JWT" },
      { "key": "internal_key", "value": "REPLACE_INTERNAL_KEY" },
      { "key": "log_type", "value": "combined" }
    ]
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      { "key": "token", "value": "{{jwt}}", "type": "string" }
    ]
  },
  "item": [
    {
      "name": "Create Round",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds"]
        },
        "body": {
          "mode": "raw",
          "raw": "{ \"name\": \"Day 3 Vote\", \"starts_at\": \"2025-09-22T12:00:00Z\" }"
        }
      }
    },
    {
      "name": "List Rounds",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds"]
        }
      }
    },
    {
      "name": "List Rounds (filter status=open)",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds?status=open",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds"],
          "query": [
            { "key": "status", "value": "open" }
          ]
        }
      }
    },
    {
      "name": "Get Active Round",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds/active",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds", "active"]
        }
      }
    },
    {
      "name": "Close Round",
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds/{{round_id}}/close",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds", "{{round_id}}", "close"]
        },
        "body": {
          "mode": "raw",
          "raw": "{}"
        }
      }
    },
    {
      "name": "Round Results",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds/{{round_id}}/results",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds", "{{round_id}}", "results"]
        }
      }
    },
    {
      "name": "Round Logs",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/rounds/logs",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "rounds", "logs"]
        }
      }
    },
    {
      "name": "Cast/Change Vote",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/votes",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "votes"]
        },
        "body": {
          "mode": "raw",
          "raw": "{ \"user_id\": {{user_id}}, \"voted_user_id\": 3, \"round_id\": \"{{round_id}}\" }"
        }
      }
    },
    {
      "name": "List Votes (for round)",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/votes?round_id={{round_id}}&limit=500&offset=0",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "votes"],
          "query": [
            { "key": "round_id", "value": "{{round_id}}" },
            { "key": "limit", "value": "500" },
            { "key": "offset", "value": "0" }
          ]
        }
      }
    },
    {
      "name": "Get Single Player Vote",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/votes/{{user_id}}?round_id={{round_id}}",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "votes", "{{user_id}}"],
          "query": [
            { "key": "round_id", "value": "{{round_id}}" }
          ]
        }
      }
    },
    {
      "name": "Remove Vote",
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/games/{{game_id}}/votes/{{user_id}}?round_id={{round_id}}",
          "host": ["{{base_url}}"],
          "path": ["games", "{{game_id}}", "votes", "{{user_id}}"],
          "query": [
            { "key": "round_id", "value": "{{round_id}}" }
          ]
        }
      }
    },
    {
      "name": "Service Status",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/status",
          "host": ["{{base_url}}"],
          "path": ["status"]
        },
        "description": "Check the health/status of the voting service (uptime, DB counts, basic metrics)."
      }
    },
    {
      "name": "Download Logs",
      "request": {
        "method": "GET",
        "header": [
          { "key": "X-Internal-Service", "value": "{{internal_key}}" }
        ],
        "url": {
          "raw": "{{base_url}}/logs/{{log_type}}",
          "host": ["{{base_url}}"],
          "path": ["logs", "{{log_type}}"]
        },
        "description": "Download a log file from the service. Valid log types: error, combined, exceptions, rejections."
      }
    }
  ]
}
